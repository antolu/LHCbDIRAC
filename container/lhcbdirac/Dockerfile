# This is a templated Dockerfile. The final Dockerfile is generated by
# dirac-docker-mgmt by just replacing $$LHCB_DIRAC_VERSION$$ with the correct value

FROM cern/slc6-base
MAINTAINER Christophe HAEN <christophe.haen@cern.ch>

RUN mkdir -p /opt/dirac/etc

RUN yum install -y git tar && yum clean all

# Copy the self pinging script
COPY dirac_self_ping.py /opt/dirac/

WORKDIR /opt/dirac

COPY dockerEntrypoint.sh /opt/dirac/dockerEntrypoint.sh
RUN chmod 755 /opt/dirac/dockerEntrypoint.sh
ENTRYPOINT [ "/opt/dirac/dockerEntrypoint.sh" ]

# Specify the version
ENV LHCB_DIRAC_VERSION v9r3-pre10

RUN curl -L -o dirac-install https://raw.githubusercontent.com/DIRACGrid/DIRAC/integration/Core/scripts/dirac-install.py && chmod +x dirac-install && ./dirac-install -r $LHCB_DIRAC_VERSION -l LHCb -e LHCb -t server -i 27 && rm -rf /opt/dirac/.installCache

# Copy the script so that when loging interactively the environment is correct
RUN cp /opt/dirac/bashrc /root/.bashrc
